var ue=Object.getOwnPropertySymbols;var Ae=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable;var fe=e=>{throw TypeError(e)};var z=(e,r)=>{var t={};for(var n in e)Ae.call(e,n)&&r.indexOf(n)<0&&(t[n]=e[n]);if(e!=null&&ue)for(var n of ue(e))r.indexOf(n)<0&&Ce.call(e,n)&&(t[n]=e[n]);return t};var ae=(e,r,t)=>r.has(e)||fe("Cannot "+t);var I=(e,r,t)=>(ae(e,r,"read from private field"),t?t.call(e):r.get(e)),G=(e,r,t)=>r.has(e)?fe("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(e):r.set(e,t),Q=(e,r,t,n)=>(ae(e,r,"write to private field"),n?n.call(e,t):r.set(e,t),t);var P=(e,r,t)=>new Promise((n,o)=>{var p=l=>{try{c(t.next(l))}catch(i){o(i)}},s=l=>{try{c(t.throw(l))}catch(i){o(i)}},c=l=>l.done?n(l.value):Promise.resolve(l.value).then(p,s);c((t=t.apply(e,r)).next())});import xe from"mithril";import k from"mithril";import X from"mithril";function ye({style:e,datatype:r,type:t,firstPickComponent:n,typeDefs:o,fallbackComponent:p}){var s,c,l;if(typeof n!="undefined")return n;if(typeof r!="undefined"&&typeof((s=o[r])==null?void 0:s[e])!="undefined")return o[r][e];if(typeof t=="string"&&typeof((c=o[t])==null?void 0:c[e])!="undefined")return o[t][e];if(Array.isArray(t)){for(let i of t)if(typeof((l=o[i])==null?void 0:l[e])!="undefined")return o[i][e]}if(typeof p!="undefined")return p}function v(e,r,t){let n,o={},p;return typeof e=="string"?n=e:typeof e=="function"?p=e:e!=null&&(o=e),typeof r=="function"?p=r:r!=null&&(o=r),typeof t=="function"&&(p=t),p==null&&(p=s=>s.present(o)),[n,o,p]}function S(e){return typeof e=="object"&&!Array.isArray(e)&&e!==null}function de(e){if(S(e)){if(typeof e["@type"]=="string")return!0;if(!Array.isArray(e["@type"]))return!1}else return!1;for(let r of e["@type"])if(typeof r!="string")return!1;return!0}function me(e){if(de(e))return e["@type"]}function re(e,r){let t=Object.assign({},r),n=me(e.value),o={isOctiron:!0,octironType:"selection",value:e.value},p=Object.assign((s,c)=>e.parent==null?null:s(e.parent)?c:null,{isOctiron:!0,octironType:"selection",readonly:!0,id:e.datatype,get value(){return o.value},get store(){return e.store},not:(s,c)=>e.parent==null||s(e.parent)?null:c,root:(s,c,l)=>{let i,[u,d,w]=v(s,c,l);return u==null?i=e.store.rootIRI:i=`${e.store.rootIRI} ${u}`,X(E,{selector:i,args:d,view:w,internals:{store:e.store,typeDefs:e.typeDefs}})},enter(s,c,l){let[i,u,d]=v(s,c,l);return X(E,{selector:i,args:u,view:d,internals:{store:e.store,typeDefs:e.typeDefs}})},select:(s,c,l)=>{let[i,u,d]=v(s,c,l);return S(e.value)?X(E,{selector:i,args:u,view:d,internals:{store:e.store,typeDefs:e.typeDefs,value:e.value}}):null},present(s){var R;let c={},l,i;(s==null?void 0:s.attrs)!=null?c=s.attrs:(t==null?void 0:t.attrs)!=null&&(c=t.attrs),(s==null?void 0:s.component)!=null?l=s.component:(t==null?void 0:t.component)!=null&&(l=t.component),(s==null?void 0:s.fallbackComponent)!=null?i=s.fallbackComponent:(t==null?void 0:t.fallbackComponent)!=null&&(i=t.fallbackComponent);let u=ye({style:"present",datatype:e.datatype,type:n,firstPickComponent:l,fallbackComponent:i,typeDefs:(R=e.typeDefs)!=null?R:{}});if(u==null)return null;let{pre:d,sep:w,post:m,start:a,end:O,predicate:A}=Object.assign({},t,s);return X(u,{o:p,renderType:"present",value:p.value,attrs:c,pre:d,sep:w,post:m,start:a,end:O,predicate:A})},_updateArgs:s=>{for(let[c,l]of Object.entries(s))t[c]=l},_updateValue:s=>{o.value=s}});return p}import Je from"mithril";var Y=typeof window!="undefined";function ne(){Y&&Je.redraw()}function Ne(e,r){return e.internals.store!==r.internals.store||e.selector!==r.selector||e.internals.value!==r.internals.value}var E=e=>{let r=Symbol("SelectionRenderer"),t=e.attrs,n,o={};function p(){let i=!1,{store:u,typeDefs:d}=t.internals,w=[];if(n==null){let a=Reflect.ownKeys(o);for(let O of a)w.includes(O)||(i=!0,delete o[O]);i&&ne();return}for(let a of n.result){if(w.push(a.key),Object.hasOwn(o,a.key)){let A=a,R=o[a.key].selectionResult;if(R.type==="value"&&A.type==="value"&&A.value===R.value)continue;if(R.type==="entity"&&A.type==="entity"&&(A.ok!==R.ok||A.status!==R.status||A.value!==R.value))continue}i=!0;let O;a.type==="entity"?O=re({store:u,typeDefs:d,value:a.value}):O=re({store:u,typeDefs:d,value:a.value,datatype:a.datatype}),o[a.key]={octiron:O,selectionResult:a}}let m=Reflect.ownKeys(o);for(let a of m)w.includes(a)||(i=!0,delete o[a]);i&&ne()}function s(i){return P(this,null,function*(){if(i.length===0)return;let u=[];for(let d of i)u.push(t.internals.store.fetch(d));yield Promise.allSettled(u)})}function c(i){let u=[];if(typeof n=="undefined")u=i.required;else for(let d of i.required)n.required.includes(d)||u.push(d);n=i,u.length>0&&s(u),p()}function l(){if(typeof t.internals.value!="undefined"&&!S(t.internals.value)){t.internals.store.unsubscribe(r),p();return}n=t.internals.store.subscribe({key:r,selector:t.selector,value:t.internals.value,listener:c}),s(n.required),p()}return{oninit:({attrs:i})=>{t=i,l()},onbeforeupdate:({attrs:i})=>{let u=Ne(i,t);t=i,u&&(i.internals.store.unsubscribe(r),l())},onbeforeremove:({attrs:i})=>{t=i,i.internals.store.unsubscribe(r)},view:({attrs:i})=>{if(n==null||!n.complete)return i.args.loading;if((n.hasErrors||n.hasMissing)&&typeof i.args.fallback!="function")return i.args.fallback;let u=t.view,{pre:d,sep:w,post:m,start:a,end:O,predicate:A,fallback:R}=t.args;if(typeof u=="undefined")return;let N=[],f=Reflect.ownKeys(o).map(y=>o[y]);(a!=null||O!=null)&&(f=f.slice(a!=null?a:0,O)),A!=null&&(f=f.filter(({octiron:y})=>A(y))),d!=null&&N.push(k.fragment({key:Ve},[d]));for(let y=0;y<f.length;y++){let{selectionResult:g,octiron:h}=f[y],{key:b}=g;y!==0&&N.push(k.fragment({key:`@${Symbol.keyFor(b)}`},[w])),g.type==="value"?N.push(k.fragment({key:b},[u(h)])):!g.ok&&typeof R=="function"?N.push(k.fragment({key:b},[R(h,g.reason)])):g.ok?N.push(k.fragment({key:b},[u(h)])):N.push(k.fragment({key:b},[R]))}return m!=null&&N.push(k.fragment({key:Pe},[m])),N}}},Ve=Symbol.for("@pre"),Pe=Symbol.for("@post");function Se(e){let r=Object.assign((t,n)=>r.root(o=>o(t,n)),{octironType:"root",isOctiron:!0,readonly:!0,value:null,store:e.store,not(t,n){return r.root(o=>o.not(t,n))},root(t,n,o){let p,[s,c,l]=v(t,n,o);return s==null?p=e.store.rootIRI:p=`${e.store.rootIRI} ${s}`,xe(E,{selector:p,args:c,view:l,internals:{store:e.store,typeDefs:e.typeDefs}})},select(t,n,o){return r.root(t,n,o)},present(t,n){return r.root(t,n)}});return r}function F(e){return Array.isArray(e)?e:Array.isArray(e["@list"])?e["@list"]:Array.isArray(e["@set"])?e["@set"]:[]}function x(e){return S(e)&&typeof e["@id"]=="string"&&e["@id"]!==""}function H(e){if(Array.isArray(e))return!0;if(S(e)){if(Array.isArray(e["@list"]))return!0;if(Array.isArray(e["@set"]))return!0}return!1}function D(e){let r=Object.keys(e);if(r.length===0)return!1;for(let t of r)if(!t.startsWith("@")||t==="@value"||t==="@list"||t==="@set")return!1;return!0}function L(e){return typeof e["@value"]!="undefined"}function M(e,r=[]){if(Array.isArray(e))for(let t of e)M(t,r);else if(S(e)){if(D(e))return r;if(x(e)&&r.push(e),L(e))M(e["@value"],r);else if(H(e))M(F(e),r);else for(let[t,n]of Object.entries(e))t.startsWith("@")||M(n,r)}return r}function Oe(...e){return`${e.map(t=>t.replace(/~/,"~0").replace(/\//,"~1")).join("/")}`}var Te=new RegExp("\\s*(?<subject>([^\\[\\s]+))(\\[(?<filter>([^\\]])+)\\])?\\s*","g");function oe(e){var n,o;let r,t=[];for(;r=Te.exec(e);){let p=(n=r.groups)==null?void 0:n.subject,s=(o=r.groups)==null?void 0:o.filter;if(typeof s=="string"&&typeof p=="string")t.push({subject:p,filter:s});else if(typeof p=="string")t.push({subject:p});else throw new Error(`Invalid selector: ${e}`)}return t}var se=class extends Error{};function ge(e){for(let r=0;r<e.result.length;r++){let t=e.result[r];t.key=Symbol.for(t.keySource),delete t.keySource}return e}function Z({selector:e,value:r,actionValue:t,store:n}){let o={complete:!1,hasErrors:!1,hasMissing:!1,required:[],dependencies:[],result:[]};if(typeof r=="undefined"){let[{subject:s,filter:c},...l]=oe(e);return _({keySource:"",pointer:"",iri:s,filter:c,selector:l.length>0?l:void 0,store:n,details:o}),o.complete=o.required.length===0,ge(o)}let p=oe(e);K({keySource:"",pointer:"",value:r,actionValue:t,selector:p,store:n,details:o}),o.complete=o.required.length===0;for(let s=0;s<o.result.length;s++){let c=o.result[s];c.key=Symbol.for(c.keySource)}return ge(o)}function J(e,r){return`${e}/${Oe(r.toString())}`}function le({value:e,filter:r}){return typeof r!="string"?!0:Array.isArray(e["@type"])?e["@type"].includes(r):e["@type"]===r}function ce(e){return e!==null&&typeof e!="undefined"&&typeof e!="boolean"&&typeof e!="number"&&typeof e!="string"}function ie({keySource:e,pointer:r,value:t,datatype:n,filter:o,store:p,details:s}){if(t==null){s.hasMissing=!0;return}if(ce(t)){if(H(t)){let c=F(t);for(let l=0;l<c.length;l++){let i=c[l];if(x(i)||(e=J(e,l)),ie({keySource:e,pointer:J(r,l),value:i,datatype:n,filter:o,store:p,details:s}),s.hasErrors||s.hasMissing)return}return}}else{s.result.push({keySource:r,pointer:r,type:"value",datatype:n,value:t});return}if(!(typeof o=="string"&&!le({value:t,filter:o}))){if(L(t)){ie({keySource:e,pointer:r,value:t["@value"],datatype:n,store:p,details:s});return}else if(D(t)){_({keySource:e,pointer:r,iri:t["@id"],filter:o,store:p,details:s});return}if(x(t)){let c=t["@id"],l=p.entities[c].contentType;s.result.push({keySource:e,pointer:r,type:"entity",iri:c,ok:!0,value:t,contentType:l});return}s.result.push({keySource:e,pointer:r,type:"value",datatype:n,value:t})}}function be({keySource:e,pointer:r,type:t,value:n,actionValue:o,filter:p,store:s,details:c}){if(r=J(r,t),!ce(n))return;if(H(n)){let i=F(n);for(let u=0;u<i.length;u++){let d=i[u];if(x(d)||(e=J(e,u)),be({keySource:e,pointer:J(r,u),type:t,value:d,actionValue:o,filter:p,store:s,details:c}),c.hasErrors||c.hasMissing)return}return}if(D(n)&&x(n)){_({keySource:e,pointer:r,iri:n["@id"],selector:[{subject:t,filter:p}],store:s,details:c});return}else if(D(n))return;let l;S(o==null?void 0:o[`${t}-input`])&&(l=o[`${t}-input`]),ie({keySource:e,pointer:r,value:n[t],spec:l,actionValue:o==null?void 0:o[t],datatype:t,filter:p,store:s,details:c})}function K({keySource:e,pointer:r,selector:t,value:n,actionValue:o,store:p,details:s}){if(t.length===0)return;if(!ce(n))return;if(H(n)){let w=F(n);for(let m=0;m<w.length;m++){let a=w[m];if(x(a)||(e=J(e,m)),K({keySource:e,pointer:J(r,m),selector:t,value:a,actionValue:o,store:p,details:s}),s.hasErrors||s.hasMissing)return}return}else L(n)&&K({keySource:e,pointer:r,selector:t,value:n["@value"],actionValue:o,store:p,details:s});if(D(n)&&x(n)){_({keySource:e,pointer:r,selector:t,iri:n["@id"],store:p,details:s});return}S(n)&&o!==void 0&&n[t[0].subject]==null&&(n={[t[0].subject]:null});let[c,...l]=t,{subject:i,filter:u}=c;if(n[i]==null){s.hasMissing=!0;return}if(l.length===0){be({keySource:e,pointer:r,type:i,filter:u,value:n,actionValue:o,store:p,details:s});return}if(typeof u=="string"&&!le({value:n,filter:u}))return;let d;S(o==null?void 0:o[i])&&(d=o[i]),K({keySource:J(e,i),pointer:J(r,i),selector:l,value:n[i],actionValue:d,store:p,details:s})}function _({keySource:e,pointer:r,iri:t,filter:n,selector:o,store:p,details:s,handledIRIs:c}){e=J(e,t),r=J(r,t);let l=p.entities[t];if(s.dependencies.push(t),typeof l=="undefined"||l.loading){s.required.includes(t)||s.required.push(t);return}if(!l.ok){if(s.hasErrors=!0,typeof o=="undefined"||o.length===0)return;s.result.push({keySource:e,pointer:r,type:"entity",iri:l.iri,ok:!1,status:l.status,value:l.value,contentType:l.contentType,reason:l.reason});return}let i=l.value;if(D(i)){if(c==null)c=new Set([i["@id"]]);else if(!c.has(i["@id"]))c.add(i["@id"]);else throw new se("Circular selection loop detected");return _({keySource:e,pointer:r,iri:i["@id"],filter:n,selector:o,details:s,store:p,handledIRIs:c})}if(!(typeof n=="string"&&!le({filter:n,value:i}))){if(typeof o=="undefined"){s.result.push({keySource:e,pointer:r,type:"entity",iri:l.iri,ok:!0,value:l.value,contentType:l.contentType});return}K({keySource:e,pointer:r,value:i,selector:o,store:p,details:s})}}import he from"jsonld";var je=t=>P(null,[t],function*({res:e,store:r}){let n=yield e.json();if(!S(n)&&!Array.isArray(n))throw new Error("JSON-LD Document should be an object");let o=yield he.expand(n,{documentLoader:s=>P(null,null,function*(){let l=yield(yield fetch(s,{headers:{accept:"application/ld+json"}})).json();return{documentUrl:s,document:l}})});return{value:yield he.compact(o,r.context),purpose:"json-ld"}});var $,W,ee=class{constructor(r,t){G(this,$);G(this,W);Q(this,$,r),Q(this,W,t)}get status(){return I(this,$)}get res(){return I(this,W)}undefined(){return null}http(r){return typeof r=="function"?r(I(this,$)):r}unparserable(){return null}};$=new WeakMap,W=new WeakMap;var q,te=class{constructor(r){G(this,q);Q(this,q,r)}get error(){return I(this,q)}undefined(){return null}http(){return null}unparserable(r){return typeof r=="function"?r(I(this,q)):r}};q=new WeakMap;function Re(p){var s=p,{rootIRI:e,vocab:r,fetcher:t,responseHook:n}=s,o=z(s,["rootIRI","vocab","fetcher","responseHook"]);let c={},l=o.headers||{},i=o.handlers||{},u=o.entities||{},d=o.aliases||{},w=t||fetch;if(typeof r=="string"&&(c["@vocab"]=r),typeof o.aliases!="undefined")for(let[f,y]of Object.entries(o.aliases))c[f]=y;let m={rootIRI:e,vocab:r,aliases:d,entities:u,context:c};i["application/ld+json"]==null&&(i["application/ld+json"]=je);let a={},O={};function A({key:f,details:y}){return function(){delete O[f];for(let h of y.dependencies){if(typeof a[h]=="undefined")continue;let b=a[h].indexOf(f);a[h].splice(b,1),Y&&a[h].length===0&&delete u[h]}}}function R(f){let y=[...a[f]||[]];for(let g of y){let{selector:h,value:b,listener:C}=O[g],j=Z({selector:h,value:b,store:m}),U=A({key:g,details:j});for(let V of j.dependencies)Array.isArray(a[V])?a[V].push(g):a[V]=[g];O[g].cleanup=U,C(j)}}function N(g){return P(this,arguments,function*(f,y={}){if(u[f])return;u[f]={iri:f,loading:!0};let h=new Promise(b=>{setTimeout(()=>P(null,null,function*(){var U;let C=yield w(f,{method:(U=y.method)!=null?U:"get",headers:Object.assign({},l,y.headers),body:y.body}),j=C.headers.get("content-type");if(j===null||i[j]===null){let V=new Error(`Unsupported content type ${j}`),B=new te(V);u[f]={iri:f,loading:!1,ok:!1,value:{},status:C.status,contentType:j,reason:B};return}try{let{purpose:V,value:B}=yield i[j]({res:C,store:m}),pe=[f];if(C.ok)u[f]={iri:f,loading:!1,ok:!0,value:B,contentType:j};else{let T=new ee(C.status,C);u[f]={iri:f,loading:!1,ok:!1,value:B,status:C.status,contentType:j,reason:T}}if(V==="json-ld")for(let T of M(B))pe.includes(T["@id"])||(u[T["@id"]]={iri:T["@id"],loading:!1,ok:!0,value:T,contentType:j});for(let T of pe)R(T)}catch(V){console.error(V)}b(C)}))});typeof n=="function"&&n(h),yield h})}m.fetch=function(f){return P(this,null,function*(){return yield N(f),u[f]})},m.expand=function(f){if(f.includes(":")){let[y,g]=f.split(":");return`${d[y]}${g}`}else if(typeof r!="string")return f;return`${r}${f}`},m.select=(f,y)=>Z({selector:f,value:y,store:m}),m.subscribe=function({key:f,selector:y,value:g,listener:h}){let b=Z({selector:y,value:g,store:m}),C=A({key:f,details:b});for(let j of b.dependencies)Array.isArray(a[j])?a[j].push(f):a[j]=[f];return O[f]={key:f,selector:y,value:g,required:b.required,dependencies:b.dependencies,listener:h,cleanup:C},b},m.unsubscribe=function(f){var y;(y=O[f])==null||y.cleanup()},typeof r=="string"&&(c["@vocab"]=r);for(let[f,y]of Object.entries(d))c[f]=y;return l.accept==null&&(l.accept="application/ld+json"),m}function we(...e){let r={};for(let t of e)r[t.type]=t;return r}function De(t){var n=t,{typeDefs:e}=n,r=z(n,["typeDefs"]);let o=typeof e!="undefined"?we(...e):{},p=Re(r);return Se({store:p,typeDefs:o})}export{De as default};
